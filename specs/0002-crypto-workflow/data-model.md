# Data Model: Crypto Workflow

**Feature**: 0002-crypto-workflow
**Date**: 2025-11-08
**Based on**: spec.md requirements

## Overview

The crypto workflow operates on time-series financial data with the following key entities. All data is stored in qlib's binary format in data/qlib_data/crypto.

## Entity Definitions

### Crypto Instrument
Represents a cryptocurrency trading pair available for analysis and trading.

**Fields**:
- `symbol` (string, required): Trading pair symbol (e.g., "BTC/USDT")
- `base_currency` (string, required): Base cryptocurrency (e.g., "BTC")
- `quote_currency` (string, required): Quote currency (e.g., "USDT")

**Validation Rules**:
- Symbol must be in top 50 list from config/top50_symbols.json
- Base and quote currencies must be valid cryptocurrency codes

**Relationships**: None (standalone entity)

### OHLCV Data
Time-series market data for crypto instruments with 15-minute frequency.

**Fields**:
- `timestamp` (datetime, required): 15-minute interval timestamp
- `open` (float, required): Opening price
- `high` (float, required): Highest price in interval
- `low` (float, required): Lowest price in interval
- `close` (float, required): Closing price
- `volume` (float, required): Trading volume

**Validation Rules**:
- All price fields must be positive floats
- Volume must be non-negative
- Timestamp must be within 2021-01-01 to 2024-01-01 range
- Data must be in 15-minute intervals

**Relationships**:
- Belongs to: Crypto Instrument (via symbol)

### Trained Model
Machine learning model trained on crypto OHLCV data for signal generation.

**Fields**:
- `model_type` (string, required): Model algorithm (e.g., "GBDT")
- `training_data_range` (date range, required): Time period used for training
- `instruments_trained` (list of strings, required): Instruments included in training
- `model_parameters` (dict, optional): Hyperparameters used
- `training_metrics` (dict, optional): Performance metrics from training

**Validation Rules**:
- Model type must be supported by qlib
- Training data range must be valid subset of available data

**Relationships**:
- Uses: OHLCV Data (for training input)

### Trading Signal
Model predictions converted to actionable trading signals.

**Fields**:
- `instrument` (string, required): Target instrument symbol
- `timestamp` (datetime, required): Signal generation timestamp
- `signal` (float, required): Signal strength (-1 to 1, negative=bearish, positive=bullish)
- `confidence` (float, optional): Model confidence score (0-1)

**Validation Rules**:
- Signal must be in [-1, 1] range
- Confidence must be in [0, 1] range if provided
- Timestamp must align with data intervals

**Relationships**:
- Generated by: Trained Model
- References: Crypto Instrument

### Backtest Result
Portfolio performance metrics from simulated trading.

**Fields**:
- `portfolio_value` (float, required): Final portfolio value
- `total_return` (float, required): Total percentage return
- `sharpe_ratio` (float, required): Risk-adjusted return metric
- `max_drawdown` (float, required): Maximum peak-to-trough decline
- `win_rate` (float, optional): Percentage of profitable trades
- `trading_days` (integer, required): Number of trading periods

**Validation Rules**:
- Financial metrics must be calculable numbers
- Sharpe ratio should be reasonable for crypto context

**Relationships**:
- Aggregates: Trading Signal (execution results)

### Analysis Report
Signal analysis and portfolio analysis outputs.

**Fields**:
- `analysis_type` (string, required): Type of analysis ("signal" or "portfolio")
- `metrics` (dict, required): Analysis metrics and statistics
- `charts` (dict, optional): Chart data for visualization
- `generated_at` (datetime, required): Analysis timestamp

**Validation Rules**:
- Analysis type must be valid
- Metrics must contain expected statistical measures

**Relationships**:
- Analyzes: Trading Signal or Backtest Result

## Data Flow

1. **Input**: OHLCV Data loaded from data/qlib_data/crypto
2. **Processing**: Trained Model processes OHLCV Data → Trading Signal
3. **Execution**: Trading Signal fed to Backtest → Backtest Result
4. **Analysis**: Trading Signal and Backtest Result → Analysis Report

## Storage Considerations

- All data stored in qlib binary format for performance
- Time-series data indexed by timestamp and instrument
- Model artifacts saved for reproducibility
- Analysis results cached for quick access

## Configuration Management

Workflow parameters are managed through `scripts/config_manager.py` and stored in `config/workflow.json`. This provides centralized parameter management with validation and defaults.

**Configuration Sections**:
- `workflow`: Core workflow parameters (time period, frequency, instruments)
- `model`: Model training parameters (type, hyperparameters)
- `trading`: Trading execution parameters (fees, strategy settings)
- `data`: Data source paths and settings

**Parameter Validation**: ConfigManager provides default values and type checking for all parameters.